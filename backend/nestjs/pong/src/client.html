<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Socket.io Game</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>

<body>
	<h1>Socket.io Game Example</h1>
	<div id="gameStatus"></div>
	<!-- Input for player ID -->
	<label for="playerIdInput">Player ID:</label>
	<input type="text" id="playerIdInput" placeholder="Enter Player ID">

	<!-- Button for joining the game -->
	<button id="joinGameButton">Join Game</button>
	<div id="gameId"></div>

	<script>
		const gameSocket = io('/game');

		gameSocket.on('connect', () => {
			document.getElementById('gameStatus').innerText = 'Connected to Game';
		});

		const handleJoinGame = () => {
			const playerIdInput = document.getElementById('playerIdInput');
			playerId = playerIdInput.value.toString();

			if (playerId) {
				gameSocket.emit('joinGame', playerId);
				gameSocket.on(playerId, (gameId) => {
					document.getElementById('gameId').innerText = gameId;
					gameSocket.on(gameId, (gameState) => {
						console.log(gameState.player1.speed);
					});

					document.addEventListener('keydown', function(event) {
						console.log(event.key);
						gameSocket.emit('playerAction', { gameId: gameId, playerId: playerId, action: event.key });
					})
				})
			}
		}

		// Attach the handleJoinGame function to the button click event
		document.getElementById('joinGameButton').addEventListener('click', handleJoinGame);

		gameSocket.on('disconnect', () => {
			document.getElementById('gameStatus').innerText = 'Disconnected from Game';
		});

		// Close the connections when the page is closed or refreshed
		window.addEventListener('beforeunload', () => {
			gameSocket.close();
		});
	</script>
</body>
</html>
